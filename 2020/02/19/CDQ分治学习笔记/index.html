<!doctype html>
<html lang="zh"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>CDQ分治学习笔记 - xyfJASON</title><link rel="manifest" href="/blog-xcpc/manifest.json"><meta name="application-name" content="xyfJASON-xcpc"><meta name="msapplication-TileImage" content="/logo/myfavicon.png"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="xyfJASON-xcpc"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="description" content="参考博客：1 2 3 4 5"><meta property="og:type" content="blog"><meta property="og:title" content="CDQ分治学习笔记"><meta property="og:url" content="http://xyfjason.github.io/blog-xcpc/2020/02/19/CDQ%E5%88%86%E6%B2%BB%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"><meta property="og:site_name" content="xyfJASON"><meta property="og:description" content="参考博客：1 2 3 4 5"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="http://xyfjason.github.io/blog-xcpc/gallery/pexels_snowflake.jpg"><meta property="article:published_time" content="2020-02-19T12:29:48.000Z"><meta property="article:modified_time" content="2021-02-25T03:49:15.965Z"><meta property="article:author" content="xyfJASON"><meta property="article:tag" content="学习笔记"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="/blog-xcpc/gallery/pexels_snowflake.jpg"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"http://xyfjason.github.io/blog-xcpc/2020/02/19/CDQ%E5%88%86%E6%B2%BB%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"},"headline":"CDQ分治学习笔记","image":["http://xyfjason.github.io/blog-xcpc/gallery/pexels_snowflake.jpg"],"datePublished":"2020-02-19T12:29:48.000Z","dateModified":"2021-02-25T03:49:15.965Z","author":{"@type":"Person","name":"xyfJASON"},"publisher":{"@type":"Organization","name":"xyfJASON","logo":{"@type":"ImageObject","url":"http://xyfjason.github.io/logo/logo.png"}},"description":"参考博客：1 2 3 4 5"}</script><link rel="canonical" href="http://xyfjason.github.io/blog-xcpc/2020/02/19/CDQ%E5%88%86%E6%B2%BB%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"><link rel="icon" href="/blog-xcpc/logo/myfavicon.png"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.2/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/blog-xcpc/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css"><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script><!--!--><!--!--><meta name="generator" content="Hexo 5.4.0"></head><body class="is-2-column"><nav class="navbar navbar-main"><div class="container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/blog-xcpc/"><img src="/blog-xcpc/logo/logo.png" alt="xyfJASON" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/blog-xcpc/">Home</a><a class="navbar-item" href="/blog-xcpc/archives">Archives</a><a class="navbar-item" href="/blog-xcpc/categories">Categories</a><a class="navbar-item" href="/blog-xcpc/tags">Tags</a><a class="navbar-item" href="/blog-xcpc/about">About</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="GitHub" href="https://github.com/xyfjason"><i class="fab fa-github"></i></a><a class="navbar-item search" title="搜索" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-8-widescreen"><div class="card"><div class="card-image"><span class="image is-7by3"><img class="fill" src="/blog-xcpc/gallery/pexels_snowflake.jpg" alt="CDQ分治学习笔记"></span></div><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2020-02-19T12:29:48.000Z" title="2020/2/19 下午8:29:48">2020-02-19</time>发表</span><span class="level-item"><time dateTime="2021-02-25T03:49:15.965Z" title="2021/2/25 上午11:49:15">2021-02-25</time>更新</span><span class="level-item"><a class="link-muted" href="/blog-xcpc/categories/ICPC-CCPC/">ICPC/CCPC</a><span> / </span><a class="link-muted" href="/blog-xcpc/categories/ICPC-CCPC/Notes/">Notes</a></span><span class="level-item">30 分钟读完 (大约4466个字)</span></div></div><h1 class="title is-3 is-size-4-mobile">CDQ分治学习笔记</h1><div class="content"><p>参考博客：<a target="_blank" rel="noopener" href="https://oi-wiki.org/misc/cdq-divide/#cqoi2011">1</a> <a target="_blank" rel="noopener" href="https://www.cnblogs.com/yangsongyi/p/10252352.html">2</a> <a target="_blank" rel="noopener" href="https://www.cnblogs.com/mlystdcall/p/6219421.html">3</a> <a target="_blank" rel="noopener" href="https://www.luogu.com.cn/blog/Owencodeisking/post-xue-xi-bi-ji-cdq-fen-zhi-hu-zheng-ti-er-fen">4</a> <a target="_blank" rel="noopener" href="https://www.cnblogs.com/mlystdcall/p/6232324.html">5</a> </p>
<span id="more"></span>
<h2 id="基本思想"><a href="#基本思想" class="headerlink" title="基本思想"></a>基本思想</h2><p>分治(Divide and conquer)思想是计算机科学中举足轻重的一种思想，应用范围极为广泛。</p>
<p>CDQ 分治是普通分治思想的延伸，区别主要在于：普通分治的子问题之间互不影响，而 CDQ 分治中<strong>左子区间可以对右子区间有影响</strong>。</p>
<p>CDQ 分治应用广泛，在不同地方的体现不尽相同，实现上大体上可分为如下三步：</p>
<ul>
<li>分(Divide)：将原问题分为左右两个区间的子问题</li>
<li>治(Conquer)：递归解决左右两个子区间</li>
<li>并(Combine)：合并两子区间的答案，<strong>并且处理左区间对右区间产生的影响</strong> </li>
</ul>
<p>可以发现，CDQ 分治的关键就在于如何处理左区间对右区间的影响，其余部分与普通分治相同。</p>
<p>CDQ 分治常常能够代替某些高级数据结构，并且常数更小，跑得更快。</p>
<h2 id="练习"><a href="#练习" class="headerlink" title="练习"></a>练习</h2><h3 id="二维偏序（逆序对）"><a href="#二维偏序（逆序对）" class="headerlink" title="二维偏序（逆序对）"></a>二维偏序（逆序对）</h3><p><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P1908">题目链接</a> </p>
<p>逆序对问题本质就是一个二维偏序。CDQ 分治时，为了线性统计，我们希望左右子区间的数值已经排好序了，这样双指针就可以统计。所以归并排序正好用在了这里。</p>
<p>复杂度：$T(n)=2\cdot T\left(\frac{n}{2}\right)+O(n)=O(n\lg n)$ </p>
<figure class="highlight cpp"><figcaption><span>&gt;folded</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> LL;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">500005</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n, a[N];</span><br><span class="line">LL ans;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> t[N];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">cdq</span><span class="params">(<span class="keyword">int</span> l, <span class="keyword">int</span> r)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(l == r)	<span class="keyword">return</span>;</span><br><span class="line">    <span class="keyword">int</span> mid = (l + r) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">    <span class="built_in">cdq</span>(l, mid);</span><br><span class="line">    <span class="built_in">cdq</span>(mid+<span class="number">1</span>, r);</span><br><span class="line">    t[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> lpt = l, rpt = mid+<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span>(lpt &lt;= mid &amp;&amp; rpt &lt;= r)&#123;</span><br><span class="line">        <span class="keyword">if</span>(a[lpt] &lt;= a[rpt])    t[++t[<span class="number">0</span>]] = a[lpt++];</span><br><span class="line">        <span class="keyword">else</span>    t[++t[<span class="number">0</span>]] = a[rpt++], ans += mid - lpt + <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span>(lpt &lt;= mid)   t[++t[<span class="number">0</span>]] = a[lpt++];</span><br><span class="line">    <span class="keyword">while</span>(rpt &lt;= r) t[++t[<span class="number">0</span>]] = a[rpt++];</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = l; i &lt;= r; i++) a[i] = t[i - l + <span class="number">1</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;n);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++) <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;a[i]);</span><br><span class="line">    <span class="built_in">cdq</span>(<span class="number">1</span>, n);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%lld\n&quot;</span>, ans);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<h3 id="hdu1541-Stars"><a href="#hdu1541-Stars" class="headerlink" title="hdu1541 Stars"></a>hdu1541 Stars</h3><p><a target="_blank" rel="noopener" href="http://acm.hdu.edu.cn/showproblem.php?pid=1541">题目链接</a> </p>
<p>求横纵坐标都更小的点的个数，二维偏序。</p>
<figure class="highlight cpp"><figcaption><span>&gt;folded</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">1000005</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n, ans[N];</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Node</span>&#123;</span></span><br><span class="line">    <span class="keyword">int</span> x, y, id;</span><br><span class="line">    <span class="keyword">int</span> cnt;</span><br><span class="line">&#125;node[N];</span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">cmpx</span><span class="params">(<span class="keyword">const</span> Node &amp;A, <span class="keyword">const</span> Node &amp;B)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> A.x == B.x ? A.y &lt; B.y : A.x &lt; B.x;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> t[N];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">disc</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">sort</span>(t+<span class="number">1</span>, t+t[<span class="number">0</span>]+<span class="number">1</span>);</span><br><span class="line">    t[<span class="number">0</span>] = <span class="built_in">unique</span>(t+<span class="number">1</span>, t+t[<span class="number">0</span>]+<span class="number">1</span>) - (t+<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++)</span><br><span class="line">        node[i].y = <span class="built_in">lower_bound</span>(t+<span class="number">1</span>, t+t[<span class="number">0</span>]+<span class="number">1</span>, node[i].y) - t;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Node tmp[N];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">cdq</span><span class="params">(<span class="keyword">int</span> l, <span class="keyword">int</span> r)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(l == r)  <span class="keyword">return</span>;</span><br><span class="line">    <span class="keyword">int</span> mid = (l + r) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">    <span class="built_in">cdq</span>(l, mid);</span><br><span class="line">    <span class="built_in">cdq</span>(mid+<span class="number">1</span>, r);</span><br><span class="line">    <span class="keyword">int</span> posl = l, posr = mid+<span class="number">1</span>, tid = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(posl &lt;= mid &amp;&amp; posr &lt;= r)&#123;</span><br><span class="line">        <span class="keyword">if</span>(node[posl].y &lt;= node[posr].y)    tmp[++tid] = node[posl++];</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            node[posr].cnt += posl - l;</span><br><span class="line">            tmp[++tid] = node[posr++];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span>(posl &lt;= mid)  tmp[++tid] = node[posl++];</span><br><span class="line">    <span class="keyword">while</span>(posr &lt;= r)    node[posr].cnt += posl - l, tmp[++tid] = node[posr++];</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= tid; i++)   node[i+l<span class="number">-1</span>] = tmp[i];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">while</span>(<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;n) != EOF)&#123;</span><br><span class="line">        t[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">        <span class="built_in">memset</span>(ans, <span class="number">0</span>, <span class="keyword">sizeof</span> ans);</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++)&#123;</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>, &amp;node[i].x, &amp;node[i].y);</span><br><span class="line">            t[++t[<span class="number">0</span>]] = node[i].y;</span><br><span class="line">            node[i].id = i;</span><br><span class="line">            node[i].cnt = <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">disc</span>();</span><br><span class="line">        <span class="built_in">sort</span>(node+<span class="number">1</span>, node+n+<span class="number">1</span>, cmpx);</span><br><span class="line">        <span class="built_in">cdq</span>(<span class="number">1</span>, n);</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++) ans[node[i].cnt]++;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++)  <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, ans[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<h3 id="SHOI2007-园丁的烦恼"><a href="#SHOI2007-园丁的烦恼" class="headerlink" title="[SHOI2007]园丁的烦恼"></a>[SHOI2007]园丁的烦恼</h3><p><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P2163">题目链接</a> </p>
<p>用二维前缀和转化一下，然后就是求横纵坐标都更小的点的个数，即二维偏序问题。</p>
<figure class="highlight cpp"><figcaption><span>>folded</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">500005</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n, m, tot, a[N], b[N], c[N], d[N], ans[N], maxx;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Node</span>&#123;</span></span><br><span class="line">    <span class="keyword">int</span> x, y, k, id;</span><br><span class="line">&#125;node[N*<span class="number">5</span>];</span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">cmp1</span><span class="params">(<span class="keyword">const</span> Node &amp;A, <span class="keyword">const</span> Node &amp;B)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> A.x == B.x ? (A.y == B.y ? A.k == <span class="number">0</span> : A.y &lt; B.y) : A.x &lt; B.x;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> t[N*<span class="number">5</span>];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">disc</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">sort</span>(t+<span class="number">1</span>, t+t[<span class="number">0</span>]+<span class="number">1</span>);</span><br><span class="line">    t[<span class="number">0</span>] = <span class="built_in">unique</span>(t+<span class="number">1</span>, t+t[<span class="number">0</span>]+<span class="number">1</span>) - (t+<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= tot; i++)&#123;</span><br><span class="line">        node[i].y = <span class="built_in">lower_bound</span>(t+<span class="number">1</span>, t+t[<span class="number">0</span>]+<span class="number">1</span>, node[i].y) - t;</span><br><span class="line">        maxx = <span class="built_in">max</span>(maxx, node[i].y);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Node tmp[N*<span class="number">5</span>];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">cdq</span><span class="params">(<span class="keyword">int</span> l, <span class="keyword">int</span> r)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(l == r)  <span class="keyword">return</span>;</span><br><span class="line">    <span class="keyword">int</span> mid = (l + r) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">    <span class="built_in">cdq</span>(l, mid);</span><br><span class="line">    <span class="built_in">cdq</span>(mid+<span class="number">1</span>, r);</span><br><span class="line">    <span class="keyword">int</span> posl = l, posr = mid+<span class="number">1</span>, tid = <span class="number">0</span>, res = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(posl &lt;= mid &amp;&amp; posr &lt;= r)&#123;</span><br><span class="line">        <span class="keyword">if</span>(node[posl].y &lt;= node[posr].y)&#123;</span><br><span class="line">            res += (node[posl].k == <span class="number">0</span>);</span><br><span class="line">            tmp[++tid] = node[posl++];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            ans[node[posr].id] += node[posr].k * res;</span><br><span class="line">            tmp[++tid] = node[posr++];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span>(posl &lt;= mid)  tmp[++tid] = node[posl++];</span><br><span class="line">    <span class="keyword">while</span>(posr &lt;= r)    ans[node[posr].id] += node[posr].k * res, tmp[++tid] = node[posr++];</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= tid; i++)   node[i+l<span class="number">-1</span>] = tmp[i];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>, &amp;n, &amp;m);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++)&#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>, &amp;node[i].x, &amp;node[i].y);</span><br><span class="line">        tot++;</span><br><span class="line">        t[++t[<span class="number">0</span>]] = node[i].y;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= m; i++)&#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d%d%d%d&quot;</span>, &amp;a[i], &amp;b[i], &amp;c[i], &amp;d[i]);</span><br><span class="line">        t[++t[<span class="number">0</span>]] = b[i]<span class="number">-1</span>, t[++t[<span class="number">0</span>]] = d[i];</span><br><span class="line">        node[++tot] = (Node)&#123;a[i]<span class="number">-1</span>, b[i]<span class="number">-1</span>, <span class="number">1</span>, i&#125;;</span><br><span class="line">        node[++tot] = (Node)&#123;a[i]<span class="number">-1</span>, d[i], <span class="number">-1</span>, i&#125;;</span><br><span class="line">        node[++tot] = (Node)&#123;c[i], b[i]<span class="number">-1</span>, <span class="number">-1</span>, i&#125;;</span><br><span class="line">        node[++tot] = (Node)&#123;c[i], d[i], <span class="number">1</span>, i&#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">disc</span>();</span><br><span class="line">    <span class="built_in">sort</span>(node+<span class="number">1</span>, node+tot+<span class="number">1</span>, cmp1);</span><br><span class="line">    <span class="built_in">cdq</span>(<span class="number">1</span>, tot);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= m; i++) <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, ans[i]);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<h3 id="luoguP2345-奶牛集会"><a href="#luoguP2345-奶牛集会" class="headerlink" title="luoguP2345 奶牛集会"></a>luoguP2345 奶牛集会</h3><p><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P2345">题目链接</a> </p>
<p>先把所有奶牛按照 $v$ 排序，然后 CDQ 分治。在考虑左右子区间时，左子区间的任一 $v$ 都小于右子区间的任一 $v$，于是我们只需要依次考虑右子区间的每一个元素，计算左子区间中 $x$ 比它小的坐标之和以及 $x$ 比它大的坐标之和是多少。欲在这一步做到线性，我们希望左右区间分别是按照 $x$ 排好序了的，这样就可以用双指针的方法搞出答案。正好把归并排序套上去即可。</p>
<figure class="highlight cpp"><figcaption><span>>folded</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> LL;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">20005</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n;</span><br><span class="line">LL ans;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Node</span>&#123;</span></span><br><span class="line">    LL v, x;</span><br><span class="line">&#125;node[N];</span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">cmp1</span><span class="params">(<span class="keyword">const</span> Node &amp;A, <span class="keyword">const</span> Node &amp;B)</span></span>&#123; <span class="keyword">return</span> A.v == B.v ? A.x &lt; B.x : A.v &lt; B.v; &#125;</span><br><span class="line"></span><br><span class="line">Node tmp[N];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">cdq</span><span class="params">(<span class="keyword">int</span> l, <span class="keyword">int</span> r)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(l == r)  <span class="keyword">return</span>;</span><br><span class="line">    <span class="keyword">int</span> mid = (l + r) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">    <span class="built_in">cdq</span>(l, mid);</span><br><span class="line">    <span class="built_in">cdq</span>(mid+<span class="number">1</span>, r);</span><br><span class="line">    LL sumb = <span class="number">0</span>, sums = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> pt = l;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = l; i &lt;= mid; i++)   sumb += node[i].x;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = mid + <span class="number">1</span>; i &lt;= r; i++)&#123;</span><br><span class="line">        <span class="keyword">while</span>(node[i].x &gt; node[pt].x &amp;&amp; pt &lt;= mid)&#123;</span><br><span class="line">            sumb -= node[pt].x;</span><br><span class="line">            sums += node[pt].x;</span><br><span class="line">            pt++;</span><br><span class="line">        &#125;</span><br><span class="line">        ans += node[i].v * (sumb - node[i].x * (mid + <span class="number">1</span> - pt) + node[i].x * (pt - l) - sums);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> ptl = l, ptr = mid + <span class="number">1</span>, tid = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(ptl &lt;= mid &amp;&amp; ptr &lt;= r)&#123;</span><br><span class="line">        <span class="keyword">if</span>(node[ptl].x &lt; node[ptr].x)   tmp[++tid] = node[ptl++];</span><br><span class="line">        <span class="keyword">else</span>    tmp[++tid] = node[ptr++];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span>(ptl &lt;= mid)   tmp[++tid] = node[ptl++];</span><br><span class="line">    <span class="keyword">while</span>(ptr &lt;= r) tmp[++tid] = node[ptr++];</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= tid; i++)   node[i+l<span class="number">-1</span>] = tmp[i];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;n);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++)</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%lld%lld&quot;</span>, &amp;node[i].v, &amp;node[i].x);</span><br><span class="line">    <span class="built_in">sort</span>(node+<span class="number">1</span>, node+n+<span class="number">1</span>, cmp1);</span><br><span class="line">    <span class="built_in">cdq</span>(<span class="number">1</span>, n);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%lld\n&quot;</span>, ans);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<h3 id="三维偏序（陌上花开）"><a href="#三维偏序（陌上花开）" class="headerlink" title="三维偏序（陌上花开）"></a>三维偏序（陌上花开）</h3><p><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P3810">题目链接</a> </p>
<p>先按第一维排序，然后 CDQ 分治：<code>solve(l, r)</code> 时，递归进行 <code>solve(l, mid)</code> 和 <code>solve(mid+1, r)</code>，考虑如何统计 $l\leq i\leq mid,mid+1\leq j\leq r$ 的满足 $b_i&lt;b_j$ 且 $c_i&lt;c_j$ 的点对数。把所有 $[l,r]$ 区间的元素拿出来按第二维排序，遍历一遍，遇到左区间的就按第三维丢到值域树状数组里去，遇到右区间的就查询。</p>
<p>如果题目存在重复元素，需要<strong>去重</strong>（因为 CDQ 分治只能统计左区间对右区间的答案），丢值域树状数组的时候丢重复次数。</p>
<p>复杂度：$T(n)=2\cdot T\left(\frac{n}{2}\right)+O(n\lg n)=O(n\lg^2n)$ </p>
<figure class="highlight cpp"><figcaption><span>>folded</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">100005</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> K = <span class="number">200005</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n, k, tot, ans[N], ranking[N]; <span class="comment">// ranking[i] is the number less than ith element</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Node</span>&#123;</span></span><br><span class="line">    <span class="keyword">int</span> a, b, c, dc;    <span class="comment">// dc is c after discretization</span></span><br><span class="line">    <span class="keyword">int</span> newid, cnt, num; <span class="comment">// num is the number of elements which are less than this node</span></span><br><span class="line">&#125;node[N];</span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">cmpa</span><span class="params">(<span class="keyword">const</span> Node &amp;A, <span class="keyword">const</span> Node &amp;B)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> A.a == B.a ? (A.b == B.b ? A.c &lt; B.c : A.b &lt; B.b) : A.a &lt; B.a;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">cmpb</span><span class="params">(<span class="keyword">const</span> Node &amp;A, <span class="keyword">const</span> Node &amp;B)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> A.b == B.b ? (A.c == B.c ? A.a &lt; B.a : A.c &lt; B.c) : A.b &lt; B.b;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> tc[N];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">disc</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">sort</span>(tc+<span class="number">1</span>, tc+tc[<span class="number">0</span>]+<span class="number">1</span>);</span><br><span class="line">    tc[<span class="number">0</span>] = <span class="built_in">unique</span>(tc+<span class="number">1</span>, tc+tc[<span class="number">0</span>]+<span class="number">1</span>) - (tc+<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++)</span><br><span class="line">        node[i].dc = <span class="built_in">lower_bound</span>(tc+<span class="number">1</span>, tc+tc[<span class="number">0</span>]+<span class="number">1</span>, node[i].c) - tc;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> c[N];</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">lowbit</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123; <span class="keyword">return</span> x &amp; -x; &#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> val)</span></span>&#123; <span class="keyword">while</span>(x &lt;= n)&#123; c[x] += val; x += <span class="built_in">lowbit</span>(x); &#125; &#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">sum</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> res = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(x)&#123; res += c[x]; x -= <span class="built_in">lowbit</span>(x); &#125;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">cdq</span><span class="params">(<span class="keyword">int</span> l, <span class="keyword">int</span> r)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(l == r)  <span class="keyword">return</span>;</span><br><span class="line">    <span class="keyword">int</span> mid = (l + r) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">    <span class="built_in">cdq</span>(l, mid);</span><br><span class="line">    <span class="built_in">cdq</span>(mid+<span class="number">1</span>, r);</span><br><span class="line">    <span class="built_in">sort</span>(node+l, node+r+<span class="number">1</span>, cmpb);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = l; i &lt;= r; i++)&#123;</span><br><span class="line">        <span class="keyword">if</span>(node[i].newid &lt;= mid)    <span class="built_in">add</span>(node[i].dc, node[i].cnt);</span><br><span class="line">        <span class="keyword">else</span>    node[i].num += <span class="built_in">sum</span>(node[i].dc);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = l; i &lt;= r; i++)         <span class="comment">// clear BIT</span></span><br><span class="line">        <span class="keyword">if</span>(node[i].newid &lt;= mid)</span><br><span class="line">            <span class="built_in">add</span>(node[i].dc, -node[i].cnt);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>, &amp;n, &amp;k);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++)&#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d%d%d&quot;</span>, &amp;node[i].a, &amp;node[i].b, &amp;node[i].c);</span><br><span class="line">        tc[++tc[<span class="number">0</span>]] = node[i].c;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">disc</span>();</span><br><span class="line">    <span class="built_in">sort</span>(node+<span class="number">1</span>, node+n+<span class="number">1</span>, cmpa);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++)&#123; <span class="comment">// unique</span></span><br><span class="line">        <span class="keyword">if</span>(node[i<span class="number">-1</span>].a != node[i].a || node[i<span class="number">-1</span>].b != node[i].b || node[i<span class="number">-1</span>].c != node[i].c)</span><br><span class="line">            node[++tot] = node[i], node[tot].newid = tot, node[tot].cnt = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">else</span>    node[tot].cnt++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">cdq</span>(<span class="number">1</span>, tot);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= tot; i++)   ans[node[i].num + node[i].cnt - <span class="number">1</span>] += node[i].cnt;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++)  <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, ans[i]);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<h3 id="动态逆序对"><a href="#动态逆序对" class="headerlink" title="动态逆序对"></a>动态逆序对</h3><p><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P3157">题目链接</a> </p>
<p>删去一个值后，总逆序对数等于原逆序对数减去它参与构成的逆序对数。它参与构成的逆序对分两种情况：</p>
<ul>
<li><strong>位置</strong>在其<strong>前</strong>，<strong>值</strong>更大，删去时间<strong>更大</strong> </li>
<li><strong>位置</strong>在其<strong>后</strong>，<strong>值</strong>更小，删去时间<strong>更大</strong> </li>
</ul>
<p>这分别是两种三维偏序，CDQ 分治即可。</p>
<figure class="highlight cpp"><figcaption><span>&gt;folded</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">200005</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> LL;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n, m, pos[N];</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Query</span>&#123;</span></span><br><span class="line">    <span class="keyword">int</span> tim, pos, val;</span><br><span class="line">    <span class="keyword">int</span> newid, num;</span><br><span class="line">&#125;node[N];</span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">cmp1</span><span class="params">(<span class="keyword">const</span> Query &amp;A, <span class="keyword">const</span> Query &amp;B)</span></span>&#123; <span class="keyword">return</span> A.tim &gt; B.tim; &#125;</span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">cmp2</span><span class="params">(<span class="keyword">const</span> Query &amp;A, <span class="keyword">const</span> Query &amp;B)</span></span>&#123; <span class="keyword">return</span> A.pos &gt; B.pos; &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> c[N];</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">lowbit</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123; <span class="keyword">return</span> x &amp; -x; &#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> val)</span></span>&#123; <span class="keyword">while</span>(x &lt;= n+<span class="number">1</span>)&#123; c[x] += val; x += <span class="built_in">lowbit</span>(x); &#125; &#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">sum</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> res = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(x)&#123; res += c[x]; x -= <span class="built_in">lowbit</span>(x); &#125;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">cdq</span><span class="params">(<span class="keyword">int</span> l, <span class="keyword">int</span> r)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(l == r)  <span class="keyword">return</span>;</span><br><span class="line">    <span class="keyword">int</span> mid = (l + r) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">    <span class="built_in">cdq</span>(l, mid);</span><br><span class="line">    <span class="built_in">cdq</span>(mid+<span class="number">1</span>, r);</span><br><span class="line">    <span class="built_in">sort</span>(node+l, node+r+<span class="number">1</span>, cmp2);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = l; i &lt;= r; i++)&#123;</span><br><span class="line">        <span class="keyword">if</span>(node[i].newid &lt;= mid)    <span class="built_in">add</span>(node[i].val, <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">else</span>    node[i].num += <span class="built_in">sum</span>(node[i].val);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = l; i &lt;= r; i++)</span><br><span class="line">        <span class="keyword">if</span>(node[i].newid &lt;= mid)</span><br><span class="line">            <span class="built_in">add</span>(node[i].val, <span class="number">-1</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = r; i &gt;= l; i--)&#123;</span><br><span class="line">        <span class="keyword">if</span>(node[i].newid &lt;= mid)    <span class="built_in">add</span>(n + <span class="number">1</span> - node[i].val, <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">else</span>    node[i].num += <span class="built_in">sum</span>(n + <span class="number">1</span> - node[i].val);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = r; i &gt;= l; i--)</span><br><span class="line">        <span class="keyword">if</span>(node[i].newid &lt;= mid)</span><br><span class="line">            <span class="built_in">add</span>(n + <span class="number">1</span> - node[i].val, <span class="number">-1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d%d&quot;</span>, &amp;n, &amp;m);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++)&#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;node[i].val);</span><br><span class="line">        pos[node[i].val] = i;</span><br><span class="line">        node[i].pos = i;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= m; i++)&#123;</span><br><span class="line">        <span class="keyword">int</span> x; <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;x);</span><br><span class="line">        node[pos[x]].tim = i;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++)</span><br><span class="line">        <span class="keyword">if</span>(!node[i].tim)</span><br><span class="line">            node[i].tim = m + <span class="number">1</span>;</span><br><span class="line">    LL res = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = n; i &gt;= <span class="number">1</span>; i--)</span><br><span class="line">        res += <span class="built_in">sum</span>(node[i].val - <span class="number">1</span>), <span class="built_in">add</span>(node[i].val, <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = n; i &gt;= <span class="number">1</span>; i--) <span class="built_in">add</span>(node[i].val, <span class="number">-1</span>);</span><br><span class="line">    <span class="built_in">sort</span>(node+<span class="number">1</span>, node+n+<span class="number">1</span>, cmp1);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++) node[i].newid = i;</span><br><span class="line">    <span class="built_in">cdq</span>(<span class="number">1</span>, n);</span><br><span class="line">    <span class="built_in">sort</span>(node+<span class="number">1</span>, node+n+<span class="number">1</span>, cmp1);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = n; i &gt;= n - m + <span class="number">1</span>; i--)&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%lld\n&quot;</span>, res);</span><br><span class="line">        res -= node[i].num;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<h3 id="BOI2007-Mokia"><a href="#BOI2007-Mokia" class="headerlink" title="[BOI2007]Mokia"></a>[BOI2007]Mokia</h3><p><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P4390">题目链接</a> </p>
<p>求横纵坐标以及时间都更小的点的数目，三维偏序。</p>
<p>以下代码中的排序采用了另一种方式（分别排序），两种都可以，<del>看心情用咯～</del> </p>
<figure class="highlight cpp"><figcaption><span>>folded</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> LL;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">800005</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n, tot, opt[N];</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Node</span>&#123;</span></span><br><span class="line">    <span class="keyword">int</span> x, y, t, k;</span><br><span class="line">    LL val;</span><br><span class="line">&#125;node[N];</span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">cmpt</span><span class="params">(<span class="keyword">const</span> Node &amp;A, <span class="keyword">const</span> Node &amp;B)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> A.t == B.t ? (A.x == B.x ? A.y &lt; B.y : A.x &lt; B.x) : A.t &lt; B.t;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">cmpx</span><span class="params">(<span class="keyword">const</span> Node &amp;A, <span class="keyword">const</span> Node &amp;B)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> A.x == B.x ? (A.y == B.y ? A.t &lt; B.t : A.y &lt; B.y) : A.x &lt; B.x;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> t[N];</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">disc</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">sort</span>(t+<span class="number">1</span>, t+t[<span class="number">0</span>]+<span class="number">1</span>);</span><br><span class="line">    t[<span class="number">0</span>] = <span class="built_in">unique</span>(t+<span class="number">1</span>, t+t[<span class="number">0</span>]+<span class="number">1</span>) - (t+<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= tot; i++)</span><br><span class="line">        node[i].y = <span class="built_in">lower_bound</span>(t+<span class="number">1</span>, t+t[<span class="number">0</span>]+<span class="number">1</span>, node[i].y) - t;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">LL c[N];</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">lowbit</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123; <span class="keyword">return</span> x &amp; -x; &#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> x, LL val)</span></span>&#123; <span class="keyword">while</span>(x &lt;= tot)&#123; c[x] += val; x += <span class="built_in">lowbit</span>(x); &#125; &#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> LL <span class="title">sum</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123; LL res = <span class="number">0</span>; <span class="keyword">while</span>(x)&#123; res += c[x]; x -= <span class="built_in">lowbit</span>(x); &#125; <span class="keyword">return</span> res; &#125;</span><br><span class="line"></span><br><span class="line">LL ans[N];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">cdq</span><span class="params">(<span class="keyword">int</span> l, <span class="keyword">int</span> r)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(l == r)  <span class="keyword">return</span>;</span><br><span class="line">    <span class="keyword">int</span> mid = (l + r) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">    <span class="built_in">cdq</span>(l, mid), <span class="built_in">cdq</span>(mid+<span class="number">1</span>, r);</span><br><span class="line">    <span class="built_in">sort</span>(node+l, node+mid+<span class="number">1</span>, cmpx);</span><br><span class="line">    <span class="built_in">sort</span>(node+mid+<span class="number">1</span>, node+r+<span class="number">1</span>, cmpx);</span><br><span class="line">    <span class="keyword">int</span> ptl = l, ptr;</span><br><span class="line">    <span class="keyword">for</span>(ptr = mid+<span class="number">1</span>; ptr &lt;= r; ptr++)&#123;</span><br><span class="line">        <span class="keyword">while</span>(ptl &lt;= mid &amp;&amp; node[ptl].x &lt;= node[ptr].x)&#123;</span><br><span class="line">            <span class="keyword">if</span>(node[ptl].k == <span class="number">0</span>)    <span class="built_in">add</span>(node[ptl].y, node[ptl].val);</span><br><span class="line">            ptl++;</span><br><span class="line">        &#125;</span><br><span class="line">        ans[node[ptr].t] += node[ptr].k * <span class="built_in">sum</span>(node[ptr].y);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = l; i &lt; ptl; i++) <span class="keyword">if</span>(node[i].k == <span class="number">0</span>) <span class="built_in">add</span>(node[i].y, -node[i].val);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;0 %d&quot;</span>, &amp;n);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; ; i++)&#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;opt[++opt[<span class="number">0</span>]]);</span><br><span class="line">        <span class="keyword">if</span>(opt[i] == <span class="number">3</span>)    <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(opt[i] == <span class="number">1</span>)&#123;</span><br><span class="line">            <span class="keyword">int</span> x, y; LL A; <span class="built_in">scanf</span>(<span class="string">&quot;%d%d%lld&quot;</span>, &amp;x, &amp;y, &amp;A);</span><br><span class="line">            ++tot, node[tot] = (Node)&#123;x, y, i, <span class="number">0</span>, A&#125;;</span><br><span class="line">            t[++t[<span class="number">0</span>]] = y;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(opt[i] == <span class="number">2</span>)&#123;</span><br><span class="line">            <span class="keyword">int</span> _x1, _y1, _x2, _y2;</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">&quot;%d%d%d%d&quot;</span>, &amp;_x1, &amp;_y1, &amp;_x2, &amp;_y2);</span><br><span class="line">            tot++, node[tot] = (Node)&#123;_x2, _y2, i, <span class="number">1</span>, <span class="number">0</span>&#125;;</span><br><span class="line">            tot++, node[tot] = (Node)&#123;_x1<span class="number">-1</span>, _y2, i, <span class="number">-1</span>, <span class="number">0</span>&#125;;</span><br><span class="line">            tot++, node[tot] = (Node)&#123;_x2, _y1<span class="number">-1</span>, i, <span class="number">-1</span>, <span class="number">0</span>&#125;;</span><br><span class="line">            tot++, node[tot] = (Node)&#123;_x1<span class="number">-1</span>, _y1<span class="number">-1</span>, i, <span class="number">1</span>, <span class="number">0</span>&#125;;</span><br><span class="line">            t[++t[<span class="number">0</span>]] = _y2, t[++t[<span class="number">0</span>]] = _y1<span class="number">-1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">disc</span>();</span><br><span class="line">    <span class="built_in">sort</span>(node+<span class="number">1</span>, node+tot+<span class="number">1</span>, cmpt);</span><br><span class="line">    <span class="built_in">cdq</span>(<span class="number">1</span>, tot);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= opt[<span class="number">0</span>]; i++)</span><br><span class="line">        <span class="keyword">if</span>(opt[i] == <span class="number">2</span>)</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%lld\n&quot;</span>, ans[i]);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<h3 id="luoguP4169-Violet-天使玩偶-SJY摆棋子"><a href="#luoguP4169-Violet-天使玩偶-SJY摆棋子" class="headerlink" title="luoguP4169 [Violet]天使玩偶/SJY摆棋子"></a>luoguP4169 [Violet]天使玩偶/SJY摆棋子</h3><p><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P4169">题目链接</a> </p>
<p>正解是 K-D Tree，但是也可以用 CDQ 分治做。考虑如何把最近距离问题转换成三维偏序问题——每个点的左下、左上、右下、右上部分分别求最近距离，这样就是四次三维偏序问题。为方便写代码，左上、右下、右上可以通过翻转转化成左下。</p>
<p>这道题时限很紧，<strong>在 CDQ 分治中不采用 <code>sort</code> 来排序第二维，而是套用一个归并排序</strong>，可以减少不少常数，然后提交的时候吸吸氧就可以过了。</p>
<figure class="highlight cpp"><figcaption><span>>folded</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;<span class="function"><span class="keyword">void</span> <span class="title">read</span><span class="params">(T&amp;x)</span></span>&#123;x=<span class="number">0</span>;<span class="keyword">int</span> fl=<span class="number">1</span>;<span class="keyword">char</span> ch=<span class="built_in">getchar</span>();<span class="keyword">while</span>(ch&lt;<span class="string">&#x27;0&#x27;</span>||ch&gt;<span class="string">&#x27;9&#x27;</span>)&#123;<span class="keyword">if</span>(ch==<span class="string">&#x27;-&#x27;</span>)</span><br><span class="line">            fl=<span class="number">-1</span>;ch=<span class="built_in">getchar</span>();&#125;<span class="keyword">while</span>(ch&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;ch&lt;=<span class="string">&#x27;9&#x27;</span>)&#123;x=(x&lt;&lt;<span class="number">1</span>)+(x&lt;&lt;<span class="number">3</span>)+ch-<span class="string">&#x27;0&#x27;</span>;ch=<span class="built_in">getchar</span>();&#125;x*=fl;&#125;</span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T,<span class="keyword">typename</span>...Args&gt;<span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">read</span><span class="params">(T&amp;t,Args&amp;...args)</span></span>&#123;<span class="built_in">read</span>(t);<span class="built_in">read</span>(args...);&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">1000005</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> INF = <span class="number">2e9</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n, m, tot, ans[N], maxx, maxdy, maxy, _[N];</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Node</span>&#123;</span></span><br><span class="line">    <span class="keyword">int</span> t, x, y, k, id, dy;</span><br><span class="line">&#125;node[N], nod[N];</span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">cmpt</span><span class="params">(<span class="keyword">const</span> Node &amp;A, <span class="keyword">const</span> Node &amp;B)</span></span>&#123; <span class="keyword">return</span> A.t == B.t ? (A.x == B.x ? A.y &lt; B.y : A.x &lt; B.x) : A.t &lt; B.t; &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> t[N];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">disc</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">sort</span>(t+<span class="number">1</span>, t+t[<span class="number">0</span>]+<span class="number">1</span>);</span><br><span class="line">    t[<span class="number">0</span>] = <span class="built_in">unique</span>(t+<span class="number">1</span>, t+t[<span class="number">0</span>]+<span class="number">1</span>) - (t+<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= tot; i++)&#123;</span><br><span class="line">        node[i].dy = <span class="built_in">lower_bound</span>(t+<span class="number">1</span>, t+t[<span class="number">0</span>]+<span class="number">1</span>, node[i].y) - t;</span><br><span class="line">        maxdy = <span class="built_in">max</span>(maxdy, node[i].dy);</span><br><span class="line">        maxy = <span class="built_in">max</span>(maxy, node[i].y);</span><br><span class="line">        maxx = <span class="built_in">max</span>(maxx, node[i].x);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> c[N];</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">lowbit</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123; <span class="keyword">return</span> x &amp; -x; &#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">modify</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> val)</span></span>&#123; <span class="keyword">while</span>(x &lt;= n + m + <span class="number">1</span>)&#123; c[x] = <span class="built_in">max</span>(c[x], val); x += <span class="built_in">lowbit</span>(x); &#125; &#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">queryMax</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123; <span class="keyword">int</span> res = <span class="number">-1e9</span>; <span class="keyword">while</span>(x)&#123; res = <span class="built_in">max</span>(res, c[x]); x -= <span class="built_in">lowbit</span>(x); &#125; <span class="keyword">return</span> res; &#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">clear</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123; <span class="keyword">while</span>(x &lt;= n + m + <span class="number">1</span>)&#123; c[x] = <span class="number">0</span>; x += <span class="built_in">lowbit</span>(x); &#125; &#125;</span><br><span class="line"></span><br><span class="line">Node tmp[N];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">cdq</span><span class="params">(<span class="keyword">int</span> l, <span class="keyword">int</span> r)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(l == r)  <span class="keyword">return</span>;</span><br><span class="line">    <span class="keyword">int</span> mid = (l + r) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">    <span class="built_in">cdq</span>(l, mid), <span class="built_in">cdq</span>(mid+<span class="number">1</span>, r);</span><br><span class="line">    <span class="keyword">int</span> ptl = l, tid = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> ptr = mid+<span class="number">1</span>; ptr &lt;= r; ptr++)&#123;</span><br><span class="line">        <span class="keyword">while</span>(ptl &lt;= mid &amp;&amp; node[ptl].x &lt;= node[ptr].x)&#123;</span><br><span class="line">            <span class="keyword">if</span>(node[ptl].k) <span class="built_in">modify</span>(node[ptl].dy, node[ptl].x + node[ptl].y);</span><br><span class="line">            tmp[++tid] = node[ptl++];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(node[ptr].id)&#123;</span><br><span class="line">            <span class="keyword">int</span> res = <span class="built_in">queryMax</span>(node[ptr].dy);</span><br><span class="line">            <span class="keyword">if</span>(res) ans[node[ptr].id] = <span class="built_in">min</span>(ans[node[ptr].id], node[ptr].x + node[ptr].y - <span class="built_in">queryMax</span>(node[ptr].dy));</span><br><span class="line">        &#125;</span><br><span class="line">        tmp[++tid] = node[ptr];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = l; i &lt; ptl; i++)    <span class="built_in">clear</span>(node[i].dy);</span><br><span class="line">    <span class="keyword">while</span>(ptl &lt;= mid)   tmp[++tid] = node[ptl++];</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= tid; i++)   node[i+l<span class="number">-1</span>] = tmp[i];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(n, m);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++)&#123;</span><br><span class="line">        <span class="built_in">read</span>(node[i].x, node[i].y);</span><br><span class="line">        node[i].t = <span class="number">0</span>, node[i].k = <span class="number">1</span>;</span><br><span class="line">        tot++;</span><br><span class="line">        t[++t[<span class="number">0</span>]] = node[i].y;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= m; i++)&#123;</span><br><span class="line">        tot++;</span><br><span class="line">        <span class="built_in">read</span>(_[i], node[tot].x, node[tot].y);</span><br><span class="line">        node[tot].t = i, node[tot].k = (_[i] == <span class="number">1</span>), node[tot].id = (_[i] == <span class="number">2</span>) * i;</span><br><span class="line">        t[++t[<span class="number">0</span>]] = node[tot].y;</span><br><span class="line">        ans[i] = INF;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">disc</span>();</span><br><span class="line">    <span class="built_in">sort</span>(node+<span class="number">1</span>, node+tot, cmpt);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= tot; i++)   nod[i] = node[i];</span><br><span class="line">    <span class="built_in">cdq</span>(<span class="number">1</span>, tot);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= tot; i++)</span><br><span class="line">        node[i] = nod[i], node[i].y = maxy - nod[i].y + <span class="number">1</span>, node[i].dy = maxdy - nod[i].dy + <span class="number">1</span>;</span><br><span class="line">    <span class="built_in">cdq</span>(<span class="number">1</span>, tot);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= tot; i++)</span><br><span class="line">        node[i] = nod[i], node[i].x = maxx - nod[i].x + <span class="number">1</span>;</span><br><span class="line">    <span class="built_in">cdq</span>(<span class="number">1</span>, tot);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= tot; i++)</span><br><span class="line">        node[i] = nod[i], node[i].x = maxx - nod[i].x + <span class="number">1</span>, node[i].y = maxy - nod[i].y + <span class="number">1</span>, node[i].dy = maxdy - nod[i].dy + <span class="number">1</span>;</span><br><span class="line">    <span class="built_in">cdq</span>(<span class="number">1</span>, tot);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= m; i++)</span><br><span class="line">        <span class="keyword">if</span>(_[i] == <span class="number">2</span>)</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, ans[i]);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<h3 id="四维偏序（hdu5126-stars）"><a href="#四维偏序（hdu5126-stars）" class="headerlink" title="四维偏序（hdu5126 stars）"></a>四维偏序（hdu5126 stars）</h3><p><a target="_blank" rel="noopener" href="http://acm.hdu.edu.cn/showproblem.php?pid=5126">题目链接</a> </p>
<p>CDQ 套 CDQ分治。先按第一维 $a$ 排序，然后对第一维 CDQ 分治：递归回来后根据第一维的位置打上左右标记，然后按 $b$ 排序，得到一系列形如 $(L/R,b,c,d)$ 的元素且 $b$ 递增；复制一下，对第二维 CDQ 分治并在同时对第三维排序：递归回来后左子区间都是 $(L/R,L,c,d)$，右子区间都是 $(L/R,R,c,d)$，且各自区间内的 $c$ 是递增的，然后双指针把第四维丢值域树状数组里或者查询，丢的时候记得参考第一维的 $L/R$ 情况。</p>
<p>实现时用与 CDQ 浑然一体的归并排序而非 <code>sort</code> 来减少一些常数；<strong>同时清空树状数组时尽可能少清</strong>。</p>
<p>复杂度：$T(n)=2\cdot T\left(\frac{n}{2}\right)+O(n\lg^2n)=O(n\lg^3n)$ </p>
<figure class="highlight cpp"><figcaption><span>>folded</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;<span class="function"><span class="keyword">void</span> <span class="title">read</span><span class="params">(T&amp;x)</span></span>&#123;x=<span class="number">0</span>;<span class="keyword">int</span> fl=<span class="number">1</span>;<span class="keyword">char</span> ch=<span class="built_in">getchar</span>();<span class="keyword">while</span>(ch&lt;<span class="string">&#x27;0&#x27;</span>||ch&gt;<span class="string">&#x27;9&#x27;</span>)&#123;<span class="keyword">if</span>(ch==<span class="string">&#x27;-&#x27;</span>)</span><br><span class="line">fl=<span class="number">-1</span>;ch=<span class="built_in">getchar</span>();&#125;<span class="keyword">while</span>(ch&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;ch&lt;=<span class="string">&#x27;9&#x27;</span>)&#123;x=(x&lt;&lt;<span class="number">1</span>)+(x&lt;&lt;<span class="number">3</span>)+ch-<span class="string">&#x27;0&#x27;</span>;ch=<span class="built_in">getchar</span>();&#125;x*=fl;&#125;</span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T,<span class="keyword">typename</span>...Args&gt;<span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">read</span><span class="params">(T&amp;t,Args&amp;...args)</span></span>&#123;<span class="built_in">read</span>(t);<span class="built_in">read</span>(args...);&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">50005</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> T, q, a[N], tot, ans[N];</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> LEFT 0</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> RIGHT 1</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Node</span>&#123;</span></span><br><span class="line">    <span class="keyword">int</span> t, x, y, z, k;</span><br><span class="line">    <span class="keyword">bool</span> mark;</span><br><span class="line">&#125;node[N&lt;&lt;<span class="number">3</span>];</span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">cmpt</span><span class="params">(<span class="keyword">const</span> Node &amp;A, <span class="keyword">const</span> Node &amp;B)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(A.t == B.t) <span class="keyword">if</span>(A.x == B.x) <span class="keyword">if</span>(A.y == B.y) <span class="keyword">return</span> A.z &lt; B.z;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">return</span> A.y &lt; B.y; <span class="keyword">else</span> <span class="keyword">return</span> A.x &lt; B.x; <span class="keyword">else</span> <span class="keyword">return</span> A.t &lt; B.t;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> t[N&lt;&lt;<span class="number">3</span>];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">disc</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">sort</span>(t+<span class="number">1</span>, t+t[<span class="number">0</span>]+<span class="number">1</span>);</span><br><span class="line">    t[<span class="number">0</span>] = <span class="built_in">unique</span>(t+<span class="number">1</span>, t+t[<span class="number">0</span>]+<span class="number">1</span>) - (t+<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= tot; i++)</span><br><span class="line">        node[i].z = <span class="built_in">lower_bound</span>(t+<span class="number">1</span>, t+t[<span class="number">0</span>]+<span class="number">1</span>, node[i].z) - t;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> c[N&lt;&lt;<span class="number">3</span>];</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">lowbit</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123; <span class="keyword">return</span> x &amp; -x; &#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> val)</span></span>&#123; <span class="keyword">while</span>(x &lt;= q * <span class="number">8</span>)&#123; c[x] += val; x += <span class="built_in">lowbit</span>(x); &#125; &#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">sum</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123; <span class="keyword">int</span> res = <span class="number">0</span>; <span class="keyword">while</span>(x)&#123; res += c[x]; x -= <span class="built_in">lowbit</span>(x); &#125; <span class="keyword">return</span> res; &#125;</span><br><span class="line"></span><br><span class="line">Node tmp[N&lt;&lt;<span class="number">3</span>], tmp2[N&lt;&lt;<span class="number">3</span>];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">cdq2</span><span class="params">(<span class="keyword">int</span> l, <span class="keyword">int</span> r)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(l == r)  <span class="keyword">return</span>;</span><br><span class="line">    <span class="keyword">int</span> mid = (l + r) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">    <span class="built_in">cdq2</span>(l, mid), <span class="built_in">cdq2</span>(mid+<span class="number">1</span>, r);</span><br><span class="line">    <span class="keyword">int</span> ptl = l, ptr = mid+<span class="number">1</span>, tid = l<span class="number">-1</span>, lastl;</span><br><span class="line">    <span class="keyword">while</span>(ptl &lt;= mid &amp;&amp; ptr &lt;= r)&#123;</span><br><span class="line">        <span class="keyword">if</span>(tmp[ptl].y &lt;= tmp[ptr].y)&#123;</span><br><span class="line">            <span class="keyword">if</span>(tmp[ptl].k == <span class="number">0</span> &amp;&amp; tmp[ptl].mark == LEFT)</span><br><span class="line">                <span class="built_in">add</span>(tmp[ptl].z, <span class="number">1</span>);</span><br><span class="line">            tmp2[++tid] = tmp[ptl++];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">if</span>(tmp[ptr].k != <span class="number">0</span> &amp;&amp; tmp[ptr].mark == RIGHT)</span><br><span class="line">                ans[tmp[ptr].t] += tmp[ptr].k * <span class="built_in">sum</span>(tmp[ptr].z);</span><br><span class="line">            tmp2[++tid] = tmp[ptr++];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    lastl = ptl - <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span>(ptl &lt;= mid)   tmp2[++tid] = tmp[ptl++];</span><br><span class="line">    <span class="keyword">while</span>(ptr &lt;= r)&#123;</span><br><span class="line">        <span class="keyword">if</span>(tmp[ptr].k != <span class="number">0</span> &amp;&amp; tmp[ptr].mark == RIGHT)</span><br><span class="line">            ans[tmp[ptr].t] += tmp[ptr].k * <span class="built_in">sum</span>(tmp[ptr].z);</span><br><span class="line">        tmp2[++tid] = tmp[ptr++];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = l; i &lt;= lastl; i++) <span class="comment">// crucial for decreasing constant</span></span><br><span class="line">        <span class="keyword">if</span>(tmp[i].k == <span class="number">0</span> &amp;&amp; tmp[i].mark == LEFT)</span><br><span class="line">            <span class="built_in">add</span>(tmp[i].z, <span class="number">-1</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = l; i &lt;= r; i++) tmp[i] = tmp2[i];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">cdq1</span><span class="params">(<span class="keyword">int</span> l, <span class="keyword">int</span> r)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(l == r)  <span class="keyword">return</span>;</span><br><span class="line">    <span class="keyword">int</span> mid = (l + r) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">    <span class="built_in">cdq1</span>(l, mid), <span class="built_in">cdq1</span>(mid+<span class="number">1</span>, r);</span><br><span class="line">    <span class="keyword">int</span> ptl = l, ptr = mid+<span class="number">1</span>, tid = l<span class="number">-1</span>; <span class="comment">// tid must be l-1 or it can&#x27;t be used in cdq2</span></span><br><span class="line">    <span class="keyword">while</span>(ptl &lt;= mid &amp;&amp; ptr &lt;= r)&#123;</span><br><span class="line">        <span class="keyword">if</span>(node[ptl].x &lt;= node[ptr].x)&#123;</span><br><span class="line">            node[ptl].mark = LEFT;</span><br><span class="line">            tmp[++tid] = node[ptl++];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            node[ptr].mark = RIGHT;</span><br><span class="line">            tmp[++tid] = node[ptr++];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span>(ptl &lt;= mid)   node[ptl].mark = LEFT, tmp[++tid] = node[ptl++];</span><br><span class="line">    <span class="keyword">while</span>(ptr &lt;= r)     node[ptr].mark = RIGHT, tmp[++tid] = node[ptr++];</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = l; i &lt;= r; i++)   node[i] = tmp[i];</span><br><span class="line">    <span class="built_in">cdq2</span>(l, r);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span></span>&#123;</span><br><span class="line">    tot = t[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= q; i++) ans[i] = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">read</span>(T);</span><br><span class="line">    <span class="keyword">while</span>(T--)&#123;</span><br><span class="line">        <span class="built_in">read</span>(q);</span><br><span class="line">        <span class="built_in">init</span>();</span><br><span class="line">        <span class="keyword">int</span> _x1, _y1, _z1, _x2, _y2, _z2;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= q; i++)&#123;</span><br><span class="line">            <span class="built_in">read</span>(a[i], _x1, _y1, _z1);</span><br><span class="line">            <span class="keyword">if</span>(a[i] == <span class="number">1</span>)&#123;</span><br><span class="line">                node[++tot] = (Node)&#123;i, _x1, _y1, _z1, <span class="number">0</span>&#125;;</span><br><span class="line">                t[++t[<span class="number">0</span>]] = _z1;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="built_in">read</span>(_x2, _y2, _z2);</span><br><span class="line">                node[++tot] = (Node)&#123;i, _x2, _y2, _z2, <span class="number">1</span>&#125;;</span><br><span class="line">                node[++tot] = (Node)&#123;i, _x1<span class="number">-1</span>, _y2, _z2, <span class="number">-1</span>&#125;;</span><br><span class="line">                node[++tot] = (Node)&#123;i, _x2, _y1<span class="number">-1</span>, _z2, <span class="number">-1</span>&#125;;</span><br><span class="line">                node[++tot] = (Node)&#123;i, _x2, _y2, _z1<span class="number">-1</span>, <span class="number">-1</span>&#125;;</span><br><span class="line">                node[++tot] = (Node)&#123;i, _x1<span class="number">-1</span>, _y1<span class="number">-1</span>, _z2, <span class="number">1</span>&#125;;</span><br><span class="line">                node[++tot] = (Node)&#123;i, _x1<span class="number">-1</span>, _y2, _z1<span class="number">-1</span>, <span class="number">1</span>&#125;;</span><br><span class="line">                node[++tot] = (Node)&#123;i, _x2, _y1<span class="number">-1</span>, _z1<span class="number">-1</span>, <span class="number">1</span>&#125;;</span><br><span class="line">                node[++tot] = (Node)&#123;i, _x1<span class="number">-1</span>, _y1<span class="number">-1</span>, _z1<span class="number">-1</span>, <span class="number">-1</span>&#125;;</span><br><span class="line">                t[++t[<span class="number">0</span>]] = _z2, t[++t[<span class="number">0</span>]] = _z1<span class="number">-1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">disc</span>();</span><br><span class="line">        <span class="built_in">sort</span>(node+<span class="number">1</span>, node+tot+<span class="number">1</span>, cmpt);</span><br><span class="line">        <span class="built_in">cdq1</span>(<span class="number">1</span>, tot);</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= q; i++)</span><br><span class="line">            <span class="keyword">if</span>(a[i] == <span class="number">2</span>)</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, ans[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</div><div class="article-licensing box"><div class="licensing-title"><p>CDQ分治学习笔记</p><p><a href="http://xyfjason.github.io/blog-xcpc/2020/02/19/CDQ分治学习笔记/">http://xyfjason.github.io/blog-xcpc/2020/02/19/CDQ分治学习笔记/</a></p></div><div class="licensing-meta level is-mobile"><div class="level-left"><div class="level-item is-narrow"><div><h6>作者</h6><p>xyfJASON</p></div></div><div class="level-item is-narrow"><div><h6>发布于</h6><p>2020-02-19</p></div></div><div class="level-item is-narrow"><div><h6>更新于</h6><p>2021-02-25</p></div></div><div class="level-item is-narrow"><div><h6>许可协议</h6><p><a class="icons" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="icon fab fa-creative-commons"></i></a><a class="icons" rel="noopener" target="_blank" title="Attribution" href="https://creativecommons.org/licenses/by/4.0/"><i class="icon fab fa-creative-commons-by"></i></a><a class="icons" rel="noopener" target="_blank" title="Noncommercial" href="https://creativecommons.org/licenses/by-nc/4.0/"><i class="icon fab fa-creative-commons-nc"></i></a></p></div></div></div></div></div><div class="article-tags is-size-7 mb-4"><span class="mr-2">#</span><a class="link-muted mr-2" rel="tag" href="/blog-xcpc/tags/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">学习笔记</a></div><!--!--></article></div><!--!--><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/blog-xcpc/2020/02/23/hihoCoder-1034-%E6%AF%81%E7%81%AD%E8%80%85%E9%97%AE%E9%A2%98/"><i class="level-item fas fa-chevron-left"></i><span class="level-item">[hihoCoder#1034] 毁灭者问题</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/blog-xcpc/2020/02/18/Codeforces-Round-621-Div-1-Div-2/"><span class="level-item">Codeforces Round #621 (Div.1+Div.2)</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><div class="card"><div class="card-content"><h3 class="title is-5">评论</h3><div class="content" id="valine-thread"></div><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="https://cdn.jsdelivr.net/npm/valine@1.4.14/dist/Valine.min.js"></script><script>new Valine({
            el: '#valine-thread',
            appId: "ovQ7Ukrh29Ex4n5TKqN19d5D-MdYXbMMI",
            appKey: "bGKUwhryO4w9EE9TcpEaOKGF",
            placeholder: "Please leave your footprints",
            avatar: "monsterid",
            avatarForce: false,
            meta: ["nick","mail","link"],
            pageSize: 10,
            lang: "zh-CN",
            visitor: false,
            highlight: true,
            recordIP: false,
            
            
            
            enableQQ: false,
            requiredFields: [],
        });</script></div></div></div><div class="column column-left is-4-tablet is-4-desktop is-4-widescreen  order-1"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar" src="/blog-xcpc/logo/myavatar.png" alt="xufJASON"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">xufJASON</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>Shenzhen, Guangdong</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">文章</p><a href="/blog-xcpc/archives"><p class="title">109</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">分类</p><a href="/blog-xcpc/categories"><p class="title">9</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">标签</p><a href="/blog-xcpc/tags"><p class="title">12</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/xyfjason" target="_blank" rel="noopener">关注我</a></div><div class="level is-mobile is-multiline"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/xyfjason"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Home" href="https://xyfjason.github.io"><i class="fa fa-home"></i></a></div></div></div><!--!--><div class="card widget" data-type="categories"><div class="card-content"><div class="menu"><h3 class="menu-label">分类</h3><ul class="menu-list"><li><a class="level is-mobile" href="/blog-xcpc/categories/ICPC-CCPC/"><span class="level-start"><span class="level-item">ICPC/CCPC</span></span><span class="level-end"><span class="level-item tag">108</span></span></a><ul><li><a class="level is-mobile" href="/blog-xcpc/categories/ICPC-CCPC/Contests/"><span class="level-start"><span class="level-item">Contests</span></span><span class="level-end"><span class="level-item tag">70</span></span></a><ul><li><a class="level is-mobile" href="/blog-xcpc/categories/ICPC-CCPC/Contests/CCPC/"><span class="level-start"><span class="level-item">CCPC</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/blog-xcpc/categories/ICPC-CCPC/Contests/Codeforces/"><span class="level-start"><span class="level-item">Codeforces</span></span><span class="level-end"><span class="level-item tag">45</span></span></a></li><li><a class="level is-mobile" href="/blog-xcpc/categories/ICPC-CCPC/Contests/ICPC2020/"><span class="level-start"><span class="level-item">ICPC2020</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/blog-xcpc/categories/ICPC-CCPC/Contests/%E5%85%B6%E4%BB%96/"><span class="level-start"><span class="level-item">其他</span></span><span class="level-end"><span class="level-item tag">22</span></span></a></li></ul></li><li><a class="level is-mobile" href="/blog-xcpc/categories/ICPC-CCPC/Exercises/"><span class="level-start"><span class="level-item">Exercises</span></span><span class="level-end"><span class="level-item tag">26</span></span></a></li><li><a class="level is-mobile" href="/blog-xcpc/categories/ICPC-CCPC/Notes/"><span class="level-start"><span class="level-item">Notes</span></span><span class="level-end"><span class="level-item tag">12</span></span></a></li></ul></li><li><a class="level is-mobile" href="/blog-xcpc/categories/%E9%9A%8F%E7%AC%94/"><span class="level-start"><span class="level-item">随笔</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></div></div></div><div class="card widget" data-type="recent-posts"><div class="card-content"><h3 class="menu-label">最新文章</h3><article class="media"><div class="media-content"><p class="date"><time dateTime="2021-07-04T14:40:30.000Z">2021-07-04</time></p><p class="title"><a href="/blog-xcpc/2021/07/04/Nowcoder17797E-2021%E5%B9%BF%E4%B8%9C%E7%9C%81%E8%B5%9B-Excellent-Number/">[Nowcoder17797E][2021广东省赛] Excellent Number</a></p><p class="categories"><a href="/blog-xcpc/categories/ICPC-CCPC/">ICPC/CCPC</a> / <a href="/blog-xcpc/categories/ICPC-CCPC/Exercises/">Exercises</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2021-06-11T02:29:07.000Z">2021-06-11</time></p><p class="title"><a href="/blog-xcpc/2021/06/11/Codeforces-Round-678-Div-2/">Codeforces Round #678 (Div.2)</a></p><p class="categories"><a href="/blog-xcpc/categories/ICPC-CCPC/">ICPC/CCPC</a> / <a href="/blog-xcpc/categories/ICPC-CCPC/Contests/">Contests</a> / <a href="/blog-xcpc/categories/ICPC-CCPC/Contests/Codeforces/">Codeforces</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2021-05-21T13:05:14.000Z">2021-05-21</time></p><p class="title"><a href="/blog-xcpc/2021/05/21/Codeforces-Round-721-Div-2/">Codeforces Round #721 (Div.2)</a></p><p class="categories"><a href="/blog-xcpc/categories/ICPC-CCPC/">ICPC/CCPC</a> / <a href="/blog-xcpc/categories/ICPC-CCPC/Contests/">Contests</a> / <a href="/blog-xcpc/categories/ICPC-CCPC/Contests/Codeforces/">Codeforces</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2021-05-19T14:43:13.000Z">2021-05-19</time></p><p class="title"><a href="/blog-xcpc/2021/05/19/CF833B-The-Bakery/">[CF833B] The Bakery</a></p><p class="categories"><a href="/blog-xcpc/categories/ICPC-CCPC/">ICPC/CCPC</a> / <a href="/blog-xcpc/categories/ICPC-CCPC/Exercises/">Exercises</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2021-05-19T06:44:41.000Z">2021-05-19</time></p><p class="title"><a href="/blog-xcpc/2021/05/19/ICPC-2020-%E9%93%B6%E5%B7%9D%E7%AB%99%E5%8E%9F%E5%9C%B0%E7%88%86%E7%82%B8%E8%AE%B0/">ICPC-2020 银川站原地爆炸记</a></p><p class="categories"><a href="/blog-xcpc/categories/ICPC-CCPC/">ICPC/CCPC</a> / <a href="/blog-xcpc/categories/ICPC-CCPC/Contests/">Contests</a> / <a href="/blog-xcpc/categories/ICPC-CCPC/Contests/ICPC2020/">ICPC2020</a></p></div></article></div></div><div class="card widget" data-type="tags"><div class="card-content"><div class="menu"><h3 class="menu-label">标签</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/blog-xcpc/tags/AtCoder/"><span class="tag">AtCoder</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/blog-xcpc/tags/CCPC/"><span class="tag">CCPC</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/blog-xcpc/tags/Codeforces/"><span class="tag">Codeforces</span><span class="tag">57</span></a></div><div class="control"><a class="tags has-addons" href="/blog-xcpc/tags/EOJ/"><span class="tag">EOJ</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/blog-xcpc/tags/GMCPC/"><span class="tag">GMCPC</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/blog-xcpc/tags/HDU/"><span class="tag">HDU</span><span class="tag">11</span></a></div><div class="control"><a class="tags has-addons" href="/blog-xcpc/tags/ICPC/"><span class="tag">ICPC</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/blog-xcpc/tags/Nowcoder/"><span class="tag">Nowcoder</span><span class="tag">12</span></a></div><div class="control"><a class="tags has-addons" href="/blog-xcpc/tags/POI/"><span class="tag">POI</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/blog-xcpc/tags/hihoCoder/"><span class="tag">hihoCoder</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/blog-xcpc/tags/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"><span class="tag">学习笔记</span><span class="tag">17</span></a></div><div class="control"><a class="tags has-addons" href="/blog-xcpc/tags/%E9%9A%8F%E7%AC%94/"><span class="tag">随笔</span><span class="tag">1</span></a></div></div></div></div></div></div><!--!--></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/blog-xcpc/"><img src="/blog-xcpc/logo/logo.png" alt="xyfJASON" height="28"></a><p class="is-size-7"><span>&copy; 2021 xyfJASON</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("zh-CN");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/blog-xcpc/js/column.js"></script><script src="/blog-xcpc/js/animation.js"></script><a id="back-to-top" title="回到顶端" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/blog-xcpc/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "此网站使用Cookie来改善您的体验。",
          dismiss: "知道了！",
          allow: "允许使用Cookie",
          deny: "拒绝",
          link: "了解更多",
          policy: "Cookie政策",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><script type="text/x-mathjax-config">MathJax.Hub.Config({
            'HTML-CSS': {
                matchFontHeight: false
            },
            SVG: {
                matchFontHeight: false
            },
            CommonHTML: {
                matchFontHeight: false
            },
            tex2jax: {
                inlineMath: [
                    ['$','$'],
                    ['\\(','\\)']
                ]
            }
        });</script><script src="https://cdn.jsdelivr.net/npm/mathjax@2.7.5/unpacked/MathJax.js?config=TeX-MML-AM_CHTML" defer></script><!--!--><!--!--><!--!--><script src="/blog-xcpc/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="想要查找什么..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/blog-xcpc/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/blog-xcpc/content.json"}, {"hint":"想要查找什么...","untitled":"(无标题)","posts":"文章","pages":"页面","categories":"分类","tags":"标签"});
        });</script></body></html>